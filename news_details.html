<!doctype html>
<html class="no-js" lang="zxx">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>New News</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/new-news-icon.png">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<header>
    <div class="header-area main-header">
        <div class="header-top">
            <div class=" row col-xl-12 d-flex justify-content-between align-items-center">
                <div class="header-info-left">
                    <div class="header-social d-none d-sm-block" style="margin-left: 50px">
                        <a href="#"><i class="fa fa-facebook-f"></i></a>
                        <a href="#"><i class="fa fa-instagram"></i></a>
                        <a href="#"><i class="fa fa-twitter"></i></a>
                        <a href="#"><i class="fa fa-linkedin-in"></i></a>
                        <a href="#"><i class="fa fa-tumblr"></i></a>
                    </div>
                </div>
                <div class="header-info-mid">

                    <div class="logo">
                        <a href="index.html"><img src="assets/img/new-news-logo2.png" width='400' height="auto"></a>
                    </div>
                </div>
                <div class="header-info-right d-flex align-items-center">
                    <ul id="login_state">
                        <li>
                            <form class="search-form" action="search_screen.html">
                                <i class="fa fa-search"></i>
                                <input type="search" class="form-control" placeholder="Search Here"
                                       title="Search here" name="search">
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="header-bottom  header-sticky">
            <div class="row align-items-center">
                <div class="col-xl-12">
                    <div class="logo2">
                        <a><img src="assets/img/new-news-logo2.png" width='350' height="auto"></a>
                    </div>
                    <div class="logo3 d-block d-sm-none">
                        <a><img src="assets/img/new-news-logo2.png" width='300' height="auto"></a>
                    </div>

                    <div class="main-menu text-center d-none d-lg-block">
                        <nav>
                            <ul id="navigation">
                                <li><a href="index.html">Home</a></li>
                                <li><a href="category.html?category=Politics">Politics</a></li>
                                <li><a href="category.html?category=Health">Health</a></li>
                                <li><a href="category.html?category=Economics">Economics</a></li>
                                <li><a href="category.html?category=Sport">Sport</a></li>
                                <li><a href="category.html?category=Technology">Technology</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>

                <div class="col-xl-12">
                    <div class="mobile_menu d-block d-lg-none"></div>
                </div>
            </div>
        </div>
    </div>
</header>
<main>

    <div class="psot-details pb-80" style="margin-top: 70px" id="news-details-wrapper">
    </div>


    <div class="coments-area pb-80">
        <div class="container">
            <div class="row ">
                <div class="col-xl-12">
                    <div class="small-tittle mb-30">
                        <h2>Comments</h2>
                    </div>
                </div>
            </div>
            <div class="row" id="comment-wrapper">
            </div>

            <div class="row">
                <div class="col-lg-12">

                    <div class="form-wrapper pt-80">
                        <div class="row ">
                            <div class="col-xl-12">
                                <div class="small-tittle mb-30">
                                    <h2>Drop your Comment</h2>
                                </div>
                            </div>
                        </div>
                        <div id="drop-comment">

                        </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-box message-icon mb-15">
                                        <textarea name="message" id="comment" placeholder="Comment"></textarea>
                                    </div>
                                    <div class="submit-info">
                                        <button class="submit-btn2" onclick="addComment()">Leave Comment</button>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</main>
<footer>
    <div class="footer-area footer-padding">
        <div class="container">
            <div class="row d-flex justify-content-between">
                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                    <div class="single-footer-caption mb-50">
                        <div class="single-footer-caption mb-30">

                            <div class="footer-logo mb-25">
                                <a href="index.html"><img src="assets/img/new-news-logo2.png" width="300" height="auto"></a>
                            </div>
                            <div class="footer-tittle">
                                <div class="footer-pera">
                                    <p>Science is a beautiful gift to humanity We should not distort it</p>
                                </div>
                            </div>
                            <div class="footer-social">
                                <a href="#"><i class="fa fa-facebook-f"></i></a>
                                <a href="#"><i class="fa fa-instagram"></i></a>
                                <a href="#"><i class="fa fa-twitter"></i></a>
                                <a href="#"><i class="fa fa-linkedin-in"></i></a>
                                <a href="#"><i class="fa fa-tumblr"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-2 col-lg-2 col-md-4 col-sm-5">
                    <div class="single-footer-caption mb-50">
                        <div class="footer-tittle">
                            <h4>Useful links</h4>
                            <ul>
                                <li><a href="#">About Me</a></li>
                                <li><a href="#">Become an Writer</a></li>
                                <li><a href="#">Privacy & Policy</a></li>
                                <li><a href="#">Terms</a></li>
                                <li><a href="#">Contact Us</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6">
                    <div class="single-footer-caption mb-50">
                        <div class="footer-tittle">
                            <h4>Top Categories</h4>
                            <ul>
                                <li><a href="category.html?category=Politics">Politics</a></li>
                                <li><a href="category.html?category=Health"> Health</a></li>
                                <li><a href="category.html?category=Economics">Economics</a></li>
                                <li><a href="category.html?category=Sport">Sport</a></li>
                                <li><a href="category.html?category=Technology">Technology</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                    <div class="single-footer-caption mb-50">
                        <div class="footer-tittle mb-50">
                            <h4>Subscribe Newsletter</h4>
                            <p>Subscribe our newsletter to get update news & updates.</p>
                        </div>

                        <div class="footer-form">
                            <div id="mc_embed_signup">
                                <form target="_blank"
                                      class="subscribe_form relative mail_part" novalidate>
                                    <input type="email" name="EMAIL" id="newsletter-form-email"
                                           placeholder="  Enter your email">
                                    <div class="form-icon">
                                        <button type="submit" name="submit" id="newsletter-submit"
                                                class="email_icon newsletter-submit button-contactForm">
                                            Subscribe
                                        </button>
                                    </div>
                                    <div class="mt-10 info"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer-bottom-area">
        <div class="container">
            <div class="row d-flex align-items-center footer-border">
                <div class="col-xl-12 footer-copy-right text-center">
                    <p>Copyright &copy;<script>document.write(new Date().getFullYear());</script>
                        All rights reserved | Made with <i class="fa fa-heart color-danger"
                                                           aria-hidden="true"></i> by <a
                                rel="nofollow noopener">Ali Yousefi</a>
                    </p>

                </div>
            </div>
        </div>
    </div>
</footer>

<div id="back-top">
    <a title="Go to Top"> <i class="fa fa-arrow-up" style="color: white"></i></a>
</div>


<script src="js/vendor/modernizr-3.5.0.min.js"></script>
<script src="js/vendor/jquery-1.12.4.min.js"></script>
<script src="js/popper.min.js+bootstrap.min.js.pagespeed.jc.-Z5m6ljAND.js"></script>
<script type="text/javascript" src="js/api.js"></script>
<script>
    if (localStorage.getItem('token') === null)
        localStorage.setItem('token', '');
    if (localStorage.getItem('token') === '')
        localStorage.setItem('token', guestToken);

    if (isLogin()) {
        document.getElementById('login_state').innerHTML += `<li><a class="header-btn">${getCookie('username')}</a>
                                            <ul class="multipage">
                                                <li><a href="about.html"><i class="fa fa-user" style="padding-right: 10px"></i>Profile</a></li>
                                                <li><a href="blog.html"><i class="fa fa-plus-square" style="padding-right: 10px"></i>Add news</a></li>
                                                <li><a href="blog.html"><i class="fa fa-cog" style="padding-right: 10px"></i>Setting</a></li>
                                                <li><a href="#" onclick="logout('index.html');"><i class="fa fa-sign-out" style="padding-right: 10px"></i>Logout</a></li>
                                            </ul>
                                        </li>`
    } else{
        document.getElementById('login_state').innerHTML += `<li><a href="login.html" class="header-btn" id="login_button">Sign in</a></li>`;
        document.getElementById('drop-comment').innerHTML = `<div class="submit-info">
                        <a href="login.html"><button class="submit-btn2">Login</button></a>
                    </div>`;
    }

</script>
<script>
    window.onload = function () {
        var url = document.location.href,
            params = url.split('?')[1].split('&'),
            data = {}, tmp;
        for (var i = 0, l = params.length; i < l; i++) {
            tmp = params[i].split('=');
            data[tmp[0]] = tmp[1];
        }
        console.log("fuck   " + data.name);
        let getNews = () => {
            // fetch('https://news-websitex.herokuapp.com/api/news')
            fetch('http://127.0.0.1:8000/api/getnews/' + data.id, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Token ' + localStorage.getItem('token')
                },
            })
                .then(res => res.json())
                .then(data => {
                    console.log('success: ', data);
                    buildNews(data);
                });
        };
        getNews();
        let getComment = () => {
            // fetch('https://news-websitex.herokuapp.com/api/news')
            fetch('http://127.0.0.1:8000/api/getcomment/' + data.id, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Token ' + localStorage.getItem('token')
                },
            })
                .then(res => res.json())
                .then(data => {
                    console.log('success: ', data);
                    buildComment(data);
                });
        };
        getComment();
        let increaseVisit = () => {
            // fetch('https://news-websitex.herokuapp.com/api/news')
            fetch('http://127.0.0.1:8000/api/newsvisited/' + data.id, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Token ' + localStorage.getItem('token')
                },
            })
                .then(res => res.json())
                .then(data => {
                    console.log('success: ', data);
                });
        };
        increaseVisit();
    };

    let buildNews = (news) => {
        let newsWrapper = document.getElementById('news-details-wrapper');

        let newsItem = news[0];
        document.title = newsItem.newsTitle;

        var create = new Date(newsItem.createDate);
        var modify = new Date(newsItem.modifyDate);

        let newsCard = `
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="details-img mb-40">
                            <img class="img-fluid"
                                 src="${newsItem.imageUrl}">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-8">
                        <div class="about-details-cap">
                            <h2>${newsItem.newsTitle}</h2>
                        </div>
                    </div>
                    <div class="col-lg-10">
                        <div class="about-details-cap">
                            <p class="mb-30">${newsItem.newsBody}</p>
                        </div>
                    </div>
                    <div class="col-lg-10">
                        <div class="about-details-cap">
                            <p class="mb-30">Author: ${newsItem.author}<br>
                            created: ${create.getDate()} ${create.toLocaleString('default', {month: 'short'})} ${create.getFullYear()} ${create.toLocaleTimeString()}<br>
                            modified: ${create.getDate()} ${modify.toLocaleString('default', {month: 'short'})} ${modify.getFullYear()} ${modify.toLocaleTimeString()}
                            </p>
                            </div>
                    </div>
                </div>
            </div>`;

        newsWrapper.innerHTML += newsCard;

    };

    let buildComment = (comment) => {
        let commentWrapper = document.getElementById('comment-wrapper');


        for (let i = 0; i < comment.length; i++) {

            let commentItem = comment[i];

            var create = new Date(commentItem.createDate);

            let commentCard = `<div class="col-lg-11">
                    <div class="single-comments mb-40">
                        <div class="comments-items">
                            <div class="comments-tittle">
                                <a href="profile.html?username=${commentItem.username}"><h4>${commentItem.author}</h4></a>
                                <span>${create.getDate()} ${create.toLocaleString('default', {month: 'short'})} ${create.getFullYear()} ${create.toLocaleTimeString()}</span>
                                <p>${commentItem.context}</p>
                            </div>
                        </div>
                    </div>
                </div>`;

            commentWrapper.innerHTML += commentCard;


        }





    };

</script>
<script>
    async function addComment() {

        var url = document.location.href,
            params = url.split('?')[1].split('&'),
            data = {}, tmp;
        for (var i = 0, l = params.length; i < l; i++) {
            tmp = params[i].split('=');
            data[tmp[0]] = tmp[1];
        }

        const comment = document.getElementById('comment').value;

        if (comment !== ''){

            let myBody =
                {
                    "context": comment,
                    "userID": getCookie('uid'),
                    "newsID": data.id,
                };
            let
                statusCode;
            const response = await fetch(/*'https://news-websitex.herokuapp.com/api/user'*/'http://127.0.0.1:8000/api/comment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Token ' + localStorage.getItem('token')
                },
                body: JSON.stringify(myBody),
            })
                .then(function (res) {
                        statusCode = res.status;
                        return res.json();
                    }
                )
                .then(data => {
                    console.log('success: ', data);
                    console.log(statusCode.toString());
                    // if (statusCode === 400)
                    //     document.getElementById('addNewsTitle_err').innerHTML = data['newsTitle'];
                    //     document.getElementById('addNewsBody_err').innerHTML = data['newsBody'];
                    if (statusCode === 201) {
                        customAlertObj(
                            "Success", //message
                            "success", //type:info/warning/success/error
                            "Comment added", //details
                            5000 //duration
                        );
                    }
                });

        }


    }
</script>

<script>eval(mod_pagespeed_aaYokwErtx);</script>
<script>eval(mod_pagespeed_gMJAcNlmbI);</script>

<script src="js/owl.carousel.min.js+slick.min.js.pagespeed.jc.F6wXCct6U2.js"></script>
<script>eval(mod_pagespeed_KlLvOZN8Fy);</script>
<script>eval(mod_pagespeed_$TEYNsEnUF);</script>
<script src="js/lightslider.min.js+jquery.slicknav.min.js+wow.min.js+jquery.js"></script>
<script>eval(mod_pagespeed_SsjX9wl8YK);</script>
<script>eval(mod_pagespeed_FsFY_1b99X);</script>

<script>eval(mod_pagespeed_yCBvmSHiqi);</script>
<script>eval(mod_pagespeed_6wgZmOj4mJ);</script>
<script>eval(mod_pagespeed_ACR6aNIQJ0);</script>

<script>eval(mod_pagespeed_l3DmqqKHpk);</script>
<script src="js/jquery.form.js+jquery.validate.min.js+mail-script.js+jquery.js"></script>
<script>eval(mod_pagespeed_Tz7N8H_GxJ);</script>
<script>eval(mod_pagespeed_eCe2npfiIC);</script>
<script>eval(mod_pagespeed_IEpshS3M$A);</script>
<script>eval(mod_pagespeed_no8v3TXY1I);</script>

<script>eval(mod_pagespeed_Xuk2NU2Nkf);</script>
<script>eval(mod_pagespeed_$TGHfHB1G2);</script>

</body>
</html>